(()=>{"use strict";class t{constructor(t,e,s,i=0,h=0){this.y=e,this.x=t,this.img=new Image,this.img.src=s,this.shiftX=i,this.shiftY=h}get width(){return this.img.width}get height(){return this.img.height}move(){this.x=this.x+this.shiftX,this.y=this.y+this.shiftY}draw(t){t.drawImage(this.img,this.x,this.y)}stopMoving(){this.shiftX=0,this.shiftY=0}}class e extends t{#t;constructor(t,e,s){super(t,e,"./images/balle24.png",8,4),this.theGame=s,this.#t=!1}get ballStopped(){return this.#t}set ballStopped(t){this.#t=t}move(){this.y<=0||this.y+this.height>=this.theGame.canvas.height?(this.shiftY=-this.shiftY,super.move()):this.x<=0?(this.stopMoving(),this.ballStopped=!0,document.getElementById("score1").value=parseInt(document.getElementById("score1").value)+1):this.x+this.width>=this.theGame.canvas.width&&(this.stopMoving(),this.ballStopped=!0,document.getElementById("score").value=parseInt(document.getElementById("score").value)+1),super.move()}collisionWith(t){const e=this.x>=t.x&&this.x<=t.x+t.width&&this.y>=t.y&&this.y<=t.y+t.height,s=this.x<=t.x&&this.x>=t.x-t.width&&this.y>=t.y&&this.y<=t.y+t.height;if(e&&t.x<this.theGame.canvas.width/2||s&&t.x>this.theGame.canvas.width/2){const e=this.y-t.y;this.zoneCord(t,e)}}zoneCord(t,e){const s=t.height;let i;0<=e&&e<11||77<=e&&e<=88?i=-3:11<=e&&e<22||66<=e&&e<77?i=-2:22<=e&&e<33||55<=e&&e<66?i=-1:(33<=e&&e<44||44<=e&&e<55)&&(i=0),console.log("n="+i),this.updateShifts(e,i,s)}updateShifts(t,e,s){Math.floor(3*Math.random()),t>s/2?this.x<this.theGame.canvas.width/2?(this.shiftY=-e,this.shiftX=7-Math.abs(e)):(this.shiftY=-e,this.shiftX=-this.shiftX):this.x<this.theGame.canvas.width/2?(this.shiftY=e,this.shiftX=7-Math.abs(e)):(this.shiftY=e,this.shiftX=-this.shiftX)}}class s extends t{constructor(t,e,s){super(t,e,"./images/paddle.png",0,8),this.theGame=s,this.moving=2}move(){this.verifyDirection()}moveDown(){this.shiftY=+Math.abs(this.shiftY),this.moving=4}moveUp(){this.shiftY=-Math.abs(this.shiftY),this.moving=3}noMove(){this.moving=2}stopMoving(){super.stopMoving()}verifyDirection(){3===this.moving?this.y=Math.max(0,this.y+this.shiftY):4===this.moving&&(this.y=Math.min(this.theGame.canvas.height-this.height,this.y+this.shiftY))}}class i{constructor(t){this.raf=null,this.canvas=t,this.paddle2=new s(60,this.canvas.height/2,this),this.paddle1=new s(this.canvas.width-80,this.canvas.height/2,this),this.ball=new e(this.paddle2.x,this.paddle2.y+this.paddle2.height/2,this),this.gameCanStart=!1,this.socket=null,this.firstPlayer=!1,this.secondPlayer=!1,this.ctxt=this.canvas.getContext("2d")}can;start(){this.firstPlayer&&(console.log("startFirstPlayer"),this.socket.emit("player1StartedTheGame"),this.socket.on("twoPlayersReady",(()=>{console.log("need to turn the buttons to arret"),this.launchThegame()})))}stop(){console.log("stop Game"),window.cancelAnimationFrame(this.raf),this.disconnect(),this.stopTheGame()}actualPlayer(){return this.firstPlayer?"First":"Second"}animate(){const t=this.actualPlayer();console.log("animate"+t),this.moveAndDraw(),this.raf=window.requestAnimationFrame(this.animate.bind(this))}moveAndDraw(){this.ctxt.clearRect(0,0,this.canvas.width,this.canvas.height),window.removeEventListener("keydown",this.keySpacePress.bind(this)),this.ball.draw(this.ctxt),this.ball.move(),this.paddle2.move(),this.paddle2.draw(this.ctxt),this.paddle1.move(),this.paddle1.draw(this.ctxt),this.ball.collisionWith(this.paddle2),this.ball.collisionWith(this.paddle1)}keyDownActionHandler(t){console.log("button pressed"),this.firstPlayer?(console.log("paddle2 changing position"),38==t.keyCode?(this.paddle1.moveUp(),this.sendPos("First",this.paddle1.y,this.ball.x,this.ball.y)):40==t.keyCode&&(this.paddle1.moveDown(),this.sendPos("First",this.paddle1.y,this.ball.x,this.ball.y))):this.secondPlayer&&(console.log("paddle1 changing position"),38==t.keyCode?(this.paddle2.moveUp(),this.sendPos("Second",this.paddle2.y,this.ball.x,this.ball.y)):40==t.keyCode&&(this.paddle2.moveDown(),this.sendPos("Second",this.paddle2.y,this.ball.x,this.ball.y)))}keyUpActionHandler(t){switch(t.keyCode){case 38:case 40:case 90:case 83:this.paddle2.noMove(),this.paddle1.noMove();break;case 32:break;default:return}t.preventDefault()}keySpacePress(t){32==t.keyCode&&(this.ball=new e(this.paddle2.x,this.paddle2.y+this.paddle2.height/2,this))}reachTheWall(){return!!this.ball.ballStopped}connect(){this.socket=io(),this.socket.on("welcome",(()=>{document.getElementById("start").value="Jouer",this.socket.emit("greatings")})),this.rank()}disconnect(){this.socket.emit("leave")}rank(){console.log("rank"),this.socket.on("screenPos",(t=>{3==t?(this.removeButton("start",this.stop()),document.getElementById("player").innerHTML=t):(document.getElementById("player").innerHTML=t+"Player","First"==t?(this.firstPlayer=!0,this.secondPlayer=!1):"Second"==t&&(this.firstPlayer=!1,this.secondPlayer=!0),this.playersConnected())}))}removeButton(t,e){document.getElementById(t).style.visibility="hidden",document.getElementById(t).removeEventListener("click",e)}playersConnected(){this.socket.on("canStartTheGame",(()=>{this.paddle1.draw(this.ctxt),this.paddle2.draw(this.ctxt),this.launchThegame()}))}sendPos(t,e,s,i){console.log("sendpos"),this.socket.emit("newPosition",t,e,s,i),this.socket.on("updatePos",((e,s,i,h)=>{switch(t){case"First":this.paddle2.y=s,this.ball.x=i,this.ball.y=h,this.paddle2.move(),this.paddle2.draw(this.ctxt),this.moveAndDraw(),this.paddle1.move(),this.paddle1.draw(this.ctxt),this.moveAndDraw();break;case"Second":console.log(t+"mis a jr"),this.paddle1.y=s,this.ball.x=i,this.ball.y=h,this.paddle1.move(),this.paddle1.draw(this.ctxt),this.moveAndDraw(),this.paddle2.move(),this.paddle2.draw(this.ctxt)}}))}launchThegame(){console.log("launchthegameinit"),document.getElementById("start").value="arret",this.animate()}stopTheGame(){this.socket.on("gameStopped",(()=>{this.stop()}))}}window.addEventListener("load",(()=>{const t=document.getElementById("field"),e=new i(t);window.addEventListener("keydown",e.keyDownActionHandler.bind(e)),window.addEventListener("keyup",e.keyUpActionHandler.bind(e)),document.getElementById("start").addEventListener("click",(()=>o(e)))}));let h=!1,a=!1;const o=t=>{console.log(a+"firstbutton"),console.log("started"+h),a?h?h&&(console.log("else if started"),document.getElementById("start").value="Connect",t.stop(),a=!1,h=!h):t.gameCanStart&&(console.log("pong non started"),t.start(),h=!h):(t.connect(),a=!0)}})();